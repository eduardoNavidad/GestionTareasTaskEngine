# Nombre del proceso que aparecerá en la pestaña 'Actions' de GitHub
name: Deploy TaskEngine to Azure Linux

# Define cuándo se dispara el proceso
on:
  push:
    branches:
      - master # Se ejecuta cada vez que subas cambios a la rama 'main'

jobs:
  build-and-deploy:
    # Usamos un servidor de GitHub con Ubuntu (Linux) para compilar
    runs-on: ubuntu-latest

    steps:
      # 1. Copia tu código del repositorio al servidor de GitHub
      - name: Checkout del código
        uses: actions/checkout@v4

      # 2. Instala el SDK de .NET para poder compilar
      - name: Configurar .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x' # Cambia a 6.0.x o 7.0.x si usas otra versión

      # 3. Restaura las librerías de NuGet
      - name: Restaurar dependencias
        run: dotnet restore

      # 4. Compila el proyecto en modo 'Release' (optimizado)
      - name: Compilar
        run: dotnet build --no-restore --configuration Release

      # 5. Publica el proyecto (crea la carpeta lista para subir a producción)
      # El parámetro -o indica que los archivos irán a la carpeta './publish'
      - name: Publicar app
        run: dotnet publish -c Release -o ./publish

      # 6. Despliega los archivos publicados a Azure App Service
      - name: Desplegar a Azure Web App
        uses: azure/webapps-deploy@v3
        with:
          # Nombre exacto de tu App Service en Azure
          app-name: 'ASP-ENavidad-bde4'
          # Usa el secreto que guardamos en GitHub Settings
          publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
          # Carpeta que vamos a subir
          package: ./publish